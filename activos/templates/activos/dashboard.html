{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SEMAT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'activos/css/styless.css' %}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
           <div class="logo-section d-flex align-items-center">
                <div class="logo">
                    <img src="{% static 'activos/img/slider1.jpg' %}" alt="logo"   height="70">
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">Navegaci贸n</div>
            
                
                <div class="nav-item has-submenu" id="departamentos-menu">
                    <i class="bi bi-building"></i>
                    <span>Departamentos</span>
                </div>
                <div class="submenu" id="departamentos-submenu">
                    <!-- Los departamentos se cargar谩n aqu铆 -->
                </div>
                
                <div class="nav-item has-submenu" id="reportes-menu">
                    <i class="bi bi-graph-up"></i>
                    <span>Reportes</span>
                </div>
                <div class="submenu" id="reportes-submenu">
                    <!-- Los reportes se cargar谩n aqu铆 -->
                </div>

                <a href="/activos/" class="nav-item">
                    <i class="bi bi-clipboard-data"></i>
                    <span>Activos</span>
                </a>

            </div>
            
            <div class="nav-section">
                <div class="nav-title">Configuraci贸n</div>
                
                <a href="{% url 'logout' %}" class="nav-item">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Cerrar Sesi贸n</span>
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 class="page-title">Dashboard de Activos</h1>
                <div class="user-menu">
                    <!--  AQU VA EL DROPDOWN DEL USUARIO - REEMPLAZA LO QUE HAY -->
                    <div class="dropdown">
                        <button class="btn btn-outline-light dropdown-toggle d-flex align-items-center" 
                                type="button" id="userDropdown" 
                                data-bs-toggle="dropdown" aria-expanded="false">
                            <div class="user-avatar me-2">
                                {% if user.first_name %}
                                    {{ user.first_name|first|upper }}
                                {% else %}
                                    {{ user.username|first|upper }}
                                {% endif %}
                            </div>
                            <div class="d-flex flex-column text-start">
                                <span class="fw-bold">
                                    {% if user.first_name %}
                                        {{ user.first_name }} {{ user.last_name }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                </span>
                                <small class="text-muted">
                                    {% if user.is_superuser %}
                                        Administrador
                                    {% elif user.departamento %}
                                        {{ user.departamento }}
                                    {% else %}
                                        Usuario
                                    {% endif %}
                                </small>
                            </div>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            
                            <li>
                                <a class="dropdown-item" href="{% url 'simple_password_change' %}">
                                    <i class="bi bi-key me-2"></i> Cambiar Contrase帽a
                                </a>
                            </li>
                            
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item text-danger" href="{% url 'logout' %}">
                                    <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesi贸n
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Total de Activos</div>
                    <div class="stat-value">{{ total_activos }}</div>
                    <div class="stat-change">Sistema de Gesti贸n</div>
                </div>
                
                <div class="stat-card operativo">
                    <div class="stat-title">Activos Operativos</div>
                    <div class="stat-value">{{ activos_operativos }}</div>
                </div>
                
                <div class="stat-card baja">
                    <div class="stat-title">Activos Da帽ados</div>
                    <div class="stat-value">{{activos_danados}}</div>
                </div>
            </div>
            
            <!-- Chart Section -->
            <div class="chart-container">
                <div class="chart-title">Distribuci贸n por Departamento</div>
                <div class="chart-placeholder">
                    Gr谩fico de activos por departamento
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Toggle submenu de departamentos
        document.getElementById('departamentos-menu').addEventListener('click', function() {
            this.classList.toggle('open');
            document.getElementById('departamentos-submenu').classList.toggle('open');
        });

        // Toggle submenu de reportes
        document.getElementById('reportes-menu').addEventListener('click', function() {
            this.classList.toggle('open');
            document.getElementById('reportes-submenu').classList.toggle('open');
        });

        // Datos de departamentos
        const departamentos = [
            { nombre: "Administraci贸n", url: "{% url 'detalle_departamento' 'Administraci贸n' %}", icon: "bi-folder2-open" },
            { nombre: "Fiscalizaci贸n", url: "{% url 'detalle_departamento' 'Fiscalizaci贸n' %}", icon: "bi-shield-check" },
            { nombre: "Recaudaci贸n", url: "{% url 'detalle_departamento' 'Recaudacion' %}", icon: "bi-cash-coin" },
            { nombre: "Inmuebles", url: "{% url 'detalle_departamento' 'Inmuebles' %}", icon: "bi-house-door" },
            { nombre: "Gerencia Licores", url: "{% url 'detalle_departamento' 'Gerencia Licores' %}", icon: "bi-cup-straw" },
            { nombre: "Gerencia General", url: "{% url 'detalle_departamento' 'Gerencia General' %}", icon: "bi-building" },
            { nombre: "Jur铆dica", url: "{% url 'detalle_departamento' 'Juridica' %}", icon: "bi-bank" },
            { nombre: "Inform谩tica", url: "{% url 'detalle_departamento' 'Informatica' %}", icon: "bi-pc-display" }
        ];

        // Datos de reportes
        const reportes = [
            { nombre: "Reporte GeneralExcel", url: "{% url 'exportar_activos' %}" , icon: "bi-file-bar-graph" },
            { nombre: "Reporte General PDF", url: "{% url 'exportar_pdf_activos'%}" , icon: "bi-file-bar-graph" },
        ];

        // Generar submenu de departamentos
        const submenuDepartamentos = document.getElementById('departamentos-submenu');
        departamentos.forEach(depto => {
            const item = document.createElement('a');
            item.href = depto.url;
            item.className = 'submenu-item';
            item.innerHTML = `
                <i class="bi ${depto.icon}"></i>
                <span>${depto.nombre}</span>
            `;
            submenuDepartamentos.appendChild(item);
        });

        // Generar submenu de reportes
        const submenuReportes = document.getElementById('reportes-submenu');
        reportes.forEach(reporte => {
            const item = document.createElement('a');
            item.href = reporte.url;
            item.className = 'submenu-item';
            item.innerHTML = `
                <i class="bi ${reporte.icon}"></i>
                <span>${reporte.nombre}</span>
            `;
            submenuReportes.appendChild(item);
        });

        // Cerrar submenus al hacer clic fuera
        document.addEventListener('click', function(event) {
            const menus = [
                { menu: 'departamentos-menu', sub: 'departamentos-submenu' },
                { menu: 'reportes-menu', sub: 'reportes-submenu' }
            ];

            menus.forEach(({ menu, sub }) => {
                const menuElement = document.getElementById(menu);
                const subElement = document.getElementById(sub);
                
                if (!menuElement.contains(event.target) && !subElement.contains(event.target)) {
                    menuElement.classList.remove('open');
                    subElement.classList.remove('open');
                }
            });
        });
    </script>
</body>
</html>